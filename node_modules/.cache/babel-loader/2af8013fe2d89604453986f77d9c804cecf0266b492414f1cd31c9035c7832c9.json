{"ast":null,"code":"var _jsxFileName = \"/Users/fahedsayyed/Documents/mac-and-gray/src/components/Reusable/Routes/PrivateRoute.js\",\n  _s = $RefreshSig$();\nimport { Outlet, Navigate } from 'react-router-dom';\nimport { useLocation } from 'react-router-dom';\nimport { useEffect } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { useAuth } from '../../../hooks/useAuth';\nimport SideMenu from '../SideBar';\nimport { loadUser, removeNextPath, sessionTimeout, setNextPath } from '../../../store/reducers/auth';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst PrivateRoute = () => {\n  _s();\n  const {\n    isAuthenticated,\n    expiresAtDate\n  } = useSelector(state => state.auth);\n  const nextPath = useSelector(state => state.auth.next);\n  const idToken = useAuth();\n  const dispatch = useDispatch();\n  let location = useLocation();\n  const public_routes = ['login', 'signup', 'logout', 'forgot-password', 'reset-password'];\n  useEffect(() => {\n    dispatch(loadUser());\n  }, [dispatch, location]);\n  useEffect(() => {\n    const is_public = public_routes.filter(route => location.pathname.includes(route) || route.includes(location.pathname)).length;\n    if (location.pathname && !(idToken && isAuthenticated) && !is_public && location.pathname !== \"/\") {\n      dispatch(setNextPath(location.pathname));\n    }\n  }, [location]);\n  useEffect(() => {\n    if (idToken && isAuthenticated === true && nextPath && location.pathname === nextPath) {\n      dispatch(removeNextPath());\n    }\n  }, [isAuthenticated, location]);\n  useEffect(() => {\n    if (expiresAtDate) {\n      const expiresAtDateIns = new Date(expiresAtDate);\n      const now = new Date();\n      const timeleft_in_milisec = expiresAtDateIns - now;\n      const timeout_ins = setTimeout(() => {\n        dispatch(sessionTimeout());\n      }, [timeleft_in_milisec]);\n      return () => {\n        clearTimeout(timeout_ins);\n      };\n    }\n  }, [dispatch, expiresAtDate]);\n  return idToken && isAuthenticated === true ? nextPath ? /*#__PURE__*/_jsxDEV(Navigate, {\n    to: nextPath\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 53,\n    columnNumber: 22\n  }, this) : location && location.pathname === \"/\" ? /*#__PURE__*/_jsxDEV(Navigate, {\n    to: \"/overview\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 55,\n    columnNumber: 13\n  }, this) : /*#__PURE__*/_jsxDEV(SideMenu, {\n    children: /*#__PURE__*/_jsxDEV(Outlet, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 57,\n      columnNumber: 17\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 56,\n    columnNumber: 15\n  }, this) : /*#__PURE__*/_jsxDEV(Navigate, {\n    to: `/login?${nextPath && `next=${nextPath}` || ''}`\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 60,\n    columnNumber: 15\n  }, this);\n};\n_s(PrivateRoute, \"VbKYzNzO4YJltvWVOxBXYLbcztc=\", false, function () {\n  return [useSelector, useSelector, useAuth, useDispatch, useLocation];\n});\n_c = PrivateRoute;\nexport default PrivateRoute;\nvar _c;\n$RefreshReg$(_c, \"PrivateRoute\");","map":{"version":3,"names":["Outlet","Navigate","useLocation","useEffect","useDispatch","useSelector","useAuth","SideMenu","loadUser","removeNextPath","sessionTimeout","setNextPath","jsxDEV","_jsxDEV","PrivateRoute","_s","isAuthenticated","expiresAtDate","state","auth","nextPath","next","idToken","dispatch","location","public_routes","is_public","filter","route","pathname","includes","length","expiresAtDateIns","Date","now","timeleft_in_milisec","timeout_ins","setTimeout","clearTimeout","to","fileName","_jsxFileName","lineNumber","columnNumber","children","_c","$RefreshReg$"],"sources":["/Users/fahedsayyed/Documents/mac-and-gray/src/components/Reusable/Routes/PrivateRoute.js"],"sourcesContent":["import { Outlet, Navigate } from 'react-router-dom'\r\nimport { useLocation } from 'react-router-dom';\r\n\r\nimport { useEffect } from 'react';\r\nimport { useDispatch, useSelector } from 'react-redux'\r\n\r\nimport { useAuth } from '../../../hooks/useAuth';\r\nimport SideMenu from '../SideBar';\r\nimport { loadUser, removeNextPath, sessionTimeout, setNextPath } from '../../../store/reducers/auth';\r\n\r\nconst PrivateRoute = () => {\r\n\r\n  const {isAuthenticated, expiresAtDate} = useSelector((state) => state.auth);\r\n  const nextPath = useSelector(state=> state.auth.next);\r\n  const idToken = useAuth();\r\n  const dispatch = useDispatch();\r\n  let location = useLocation();\r\n\r\n  const public_routes = ['login', 'signup', 'logout', 'forgot-password', 'reset-password'];\r\n\r\n  useEffect(()=>{\r\n    dispatch(loadUser());\r\n  },[dispatch, location])\r\n\r\n  useEffect(()=>{\r\n    const is_public = public_routes.filter(route=>location.pathname.includes(route)|| route.includes(location.pathname)).length\r\n    if(location.pathname && !(idToken && isAuthenticated) && !is_public && location.pathname !==\"/\"){\r\n      dispatch(setNextPath(location.pathname));\r\n    }\r\n  },[location])\r\n\r\n  useEffect(()=>{\r\n    if(idToken && isAuthenticated === true && nextPath && location.pathname === nextPath){\r\n      dispatch(removeNextPath())\r\n    }\r\n  },[isAuthenticated, location])\r\n\r\n  useEffect(()=>{\r\n    if(expiresAtDate){\r\n      const expiresAtDateIns = new Date(expiresAtDate);\r\n      const now = new Date();\r\n      const timeleft_in_milisec = (expiresAtDateIns - now)\r\n      const timeout_ins = setTimeout(()=>{\r\n        dispatch(sessionTimeout())\r\n      },[timeleft_in_milisec])\r\n      return (()=>{\r\n        clearTimeout(timeout_ins);\r\n      })\r\n    }\r\n  },[dispatch, expiresAtDate])\r\n\r\n  return idToken && isAuthenticated === true ? \r\n          nextPath ? <Navigate to={nextPath}/>:\r\n          location && location.pathname===\"/\" ? \r\n            <Navigate to=\"/overview\" /> : (\r\n              <SideMenu>\r\n                <Outlet />\r\n              </SideMenu>\r\n            ) : (\r\n              <Navigate to={`/login?${ nextPath && `next=${nextPath}` || ''}`} />\r\n            )\r\n}\r\n\r\nexport default PrivateRoute\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}